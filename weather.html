<html>
    <head>
        <script
        src="https://code.jquery.com/jquery-3.4.1.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
        crossorigin="anonymous"></script>
    </head>
    <body>
        <h3>Weather for today and tomorrow</h3>
        <input type="text" placeholder="city" class="city"/>
        <input type="submit">

        <script>
            function citySearchCallbacks(chosenCity) {
                var cityID;
                
                // Callbacks
                $.ajax({
                    url: 'https://cors-anywhere.herokuapp.com/https://www.metaweather.com/api/location/search/?query=' + chosenCity,
                    success: function(data) {
                        // console.log(data);

                        try {
                            cityID = data[0].woeid

                            // console.log('******* START CALLBACK DATA *******');
                            console.log(cityID);
                        } catch {
                            console.log('City not found :(');
                        }

                        $.ajax({
                            url: 'https://cors-anywhere.herokuapp.com/https://www.metaweather.com/api/location/' + cityID + '/',
                            success: function(data) {
                                console.log(`Today's weather: ${data.consolidated_weather[0].weather_state_name}`);

                                $.ajax({
                                    url: 'https://cors-anywhere.herokuapp.com/https://www.metaweather.com/api/location/' + cityID + '/',
                                    success: function(data) {
                                console.log(`Tomorrow's weather: ${data.consolidated_weather[1].weather_state_name}`);
                                // console.log('******* END CALLBACK DATA *******');
                                    }
                                })
                            }
                        })
                    },
                    error: function() {
                        console.log('AJAX error');
                    }
                });
            }
        
            // function citySearchjQPromises(chosenCity) {
            //     // note: jQ ajax returns a promise object, so you can use promise methods on it (I guess)

            // }

            function citySearchES6Promises(chosenCity) {
                // Promise objects

                var getCityID = new Promise(function(resolve, reject) {
                    $.ajax({
                        url: 'https://cors-anywhere.herokuapp.com/https://www.metaweather.com/api/location/search/?query=' + chosenCity,
                        success: function(data) {
                            console.log(data);
                            resolve(data);
                        }
                    })
                });

                var getTodaysWeather = function(cityID) {
                    return new Promise(function(resolve, reject) {
                        $.ajax({
                            url: 'https://cors-anywhere.herokuapp.com/https://www.metaweather.com/api/location/' + cityID + '/',
                            success: function(data) {
                                resolve(data.consolidated_weather[0].weather_state_name);
                            }
                        });
                    });
                }

                var getTomorrowsWeather = function(cityID) {
                    return new Promise(function(resolve, reject) {
                        $.ajax({
                            url: 'https://cors-anywhere.herokuapp.com/https://www.metaweather.com/api/location/' + cityID + '/',
                            success: function(data) {
                                resolve(data.consolidated_weather[1].weather_state_name);
                            }
                        })
                    })
                }

                var thisCityID;

                // Consume the promise objects
                getCityID
                .then(function(result) {
                    thisCityID = result[0].woeid;
                    // console.log('******* START PROMISE DATA *******');
                    console.log(thisCityID);
                    return getTodaysWeather(thisCityID);
                })
                .then(function(result) {
                    console.log(`Today's weather: ${result}`);
                    return getTomorrowsWeather(thisCityID)
                }).then(function(result) {
                    console.log(`Tomorrow's weather: ${result}`);
                    // console.log('******* END PROMISE DATA *******');
                })
            }

            // Use jQuery to get data with .ajax()
            $(document).on('click', '[type="submit"]', function() {
                var theCity = $('.city').val();
                // citySearchCallbacks(theCity);

                // citySearchjQPromises(theCity);

                citySearchES6Promises(theCity);
            });
        </script>
    </body>
</html>